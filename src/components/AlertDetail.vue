<template>
  <v-card
    flat
  >
    <v-card
      tile
      flat
    >
      <v-toolbar
        :color="isDark ? '#616161' : '#eeeeee'"
        dense
        class="flex flex-row justify-between"
      >
        <v-layout row>
          <v-flex
            grow
            pa-1
          >
            <v-card
              color="transparent"
              elevation="0"
            >
              <v-btn
                icon
                @click="dialog = false"
              >
                <v-icon>arrow_back</v-icon>
              </v-btn>
      
              <v-tooltip bottom>
                <v-btn
                  slot="activator"
                  :disabled="!isAcked(item.status) && !isClosed(item.status)"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="takeAction(item.id, 'open')"
                >
                  <v-icon
                    size="20px"
                  >
                    refresh
                  </v-icon>
                </v-btn>
                <span>{{ $t('Open') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="!isWatched(item.tags)"
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="watchAlert(item.id)"
                >
                  <v-icon
                    size="20px"
                  >
                    visibility
                  </v-icon>
                </v-btn>
                <span>{{ $t('Watch') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="isWatched(item.tags)"
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="unwatchAlert(item.id)"
                >
                  <v-icon
                    size="20px"
                  >
                    visibility_off
                  </v-icon>
                </v-btn>
                <span>{{ $t('Unwatch') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="!isAcked(item.status)"
                  slot="activator"
                  :disabled="!isOpen(item.status)"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="beforeAckAlert(item.id)"
                >
                  <v-icon
                    size="20px"
                  >
                    check
                  </v-icon>
                </v-btn>
                <span>{{ $t('Ack') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="isAcked(item.status)"
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="takeAction(item.id, 'unack')"
                >
                  <v-icon
                    size="20px"
                  >
                    undo
                  </v-icon>
                </v-btn>
                <span>{{ $t('Unack') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="!isShelved(item.status)"
                  slot="activator"
                  :disabled="!isOpen(item.status) && !isAcked(item.status)"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="shelveAlert(item.id)"
                >
                  <v-icon
                    size="20px"
                  >
                    schedule
                  </v-icon>
                </v-btn>
                <span>{{ $t('Shelve') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  v-show="isShelved(item.status)"
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="takeAction(item.id, 'unshelve')"
                >
                  <v-icon
                    size="20px"
                  >
                    restore
                  </v-icon>
                </v-btn>
                <span>{{ $t('Unshelve') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  slot="activator"
                  :disabled="isClosed(item.status)"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="takeAction(item.id, 'close')"
                >
                  <v-icon
                    size="20px"
                  >
                    highlight_off
                  </v-icon>
                </v-btn>
                <span>{{ $t('Close') }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-btn
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="deleteAlert(item.id)"
                >
                  <v-icon
                    size="20px"
                  >
                    delete
                  </v-icon>
                </v-btn>
                <span>{{ $t('Delete') }}</span>
              </v-tooltip>

              <v-tooltip
                :key="copyIconText"
                bottom
              >
                <v-btn
                  slot="activator"
                  icon
                  class="btn--plain px-1 mx-0"
                  @click="clipboardCopy(JSON.stringify(item, null, 4))"
                >
                  <v-icon
                    size="20px"
                  >
                    content_copy
                  </v-icon>
                </v-btn>
                <span>{{ copyIconText }}</span>
              </v-tooltip>
      
              <v-tooltip bottom>
                <v-menu
                  slot="activator"
                  bottom
                  left
                >
                  <v-btn
                    slot="activator"
                    icon
                    class="btn--plain px-1 mx-0"
                  >
                    <v-icon>
                      more_vert
                    </v-icon>
                  </v-btn>
      
                  <v-list
                    subheader
                  >
                    <v-subheader>Actions</v-subheader>
                    <v-divider />
                    <v-list-tile
                      v-for="(action, i) in actions"
                      :key="i"
                      @click="takeAction(item.id, action)"
                    >
                      <v-list-tile-title>{{ action | splitCaps }}</v-list-tile-title>
                    </v-list-tile>
                  </v-list>
                </v-menu>
                <span>{{ $t('More') }}</span>
              </v-tooltip>
            </v-card>
          </v-flex>
          
          <v-flex
            shrink
            pa-1
          >
            <v-tooltip bottom>
              <v-btn
                slot="activator"
                icon
                :disabled="!hasHistoryNotes"
                class="btn--plain px-1 mx-0"
                @click="displayNotes(true)"
              >
                <v-badge
                  :color="!isDark ? '#616161' : '#eeeeee'"
                  left
                >
                  <template v-slot:badge>
                    <span :style="{color: isDark ? '#616161' : '#eeeeee' }">{{ hasHistoryNotes }}</span>
                  </template>
                  <v-icon
                    size="20px"
                    style="width: 20px"
                  >
                    book_open_outline
                  </v-icon>
                </v-badge>
              </v-btn>
              <span>View notes</span>
            </v-tooltip>
          </v-flex>
        </v-layout>
      </v-toolbar>

      <v-card
        flat
      >
        <alert-actions
          v-if="item.id"
          :id="item.id"
          :status="item.status"
          :is-watched="isWatched(item.tags)"
          @take-action="takeAction"
          @ack-alert="ackAlert"
          @shelve-alert="shelveAlert"
          @watch-alert="watchAlert"
          @unwatch-alert="unwatchAlert"
          @add-note="toggleNoteDialog(true)"
          @delete-alert="deleteAlert"
          @create-ticket="createTicket"
          @assign-to="assignAlert"
          @change-severity="changeSeverity"
        />
        <v-tabs
          v-model="active"
          grow
        >
          <v-tab ripple>
            <v-icon>info</v-icon>&nbsp;{{ $t('Details') }}
          </v-tab>
          <v-tab-item
            :transition="false"
            :reverse-transition="false"
          >
            <v-card
              flat
            >
              <v-container
                fluid
                grid-list-lg
              >
                <v-layout 
                  row 
                  wrap
                >
                  <v-flex 
                    sm6 
                    md4
                  >
                    <v-card>
                      <v-container>
                        <h3 class="headline mb-0 text-xs-center">
                          Overview
                        </h3>
                        <section
                          class="my-2"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Severity') }}
                          </h3>
                          <div>
                            <template v-if="item.attributes && item.attributes.severity_raw">
                              <template v-if="item.attributes.previous_severity_raw">
                                <span :class="['label', 'label-' + item.attributes.previous_severity_raw]">
                                  {{ item.attributes.previous_severity_raw | capitalize }}
                                </span>&nbsp;&rarr;&nbsp;
                                <span :class="['label', 'label-' + item.attributes.severity_raw]">
                                  {{ item.attributes.severity_raw | capitalize }}
                                </span>
                              </template>
                              <template v-else-if="item.attributes.severity_raw">
                                <span :class="['label', 'label-' + item.severity]">
                                  {{ item.severity | capitalize }}
                                </span>&nbsp;&rarr;&nbsp;
                                <span :class="['label', 'label-' + item.attributes.severity_raw]">
                                  {{ item.attributes.severity_raw | capitalize }}
                                </span>
                              </template>
                            </template>
                            <template v-else>
                              <span :class="['label', 'label-' + item.previousSeverity]">
                                {{ item.previousSeverity | capitalize }}
                              </span>&nbsp;&rarr;&nbsp;
                              <span :class="['label', 'label-' + item.severity]">
                                {{ item.severity | capitalize }}
                              </span>
                            </template>
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section
                          class="my-2"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Service') }}
                          </h3>
                          <div
                            v-for="service in item.service"
                            :key="service"
                            class="clickable"
                            @click="queryBy('service', service)"
                          >
                            {{ service }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Text') }}
                          </h3>
                          <div
                            class="alert-word-break"
                            v-html="item.text"
                          />
                        </section>
                        <v-divider class="my-2" />
                        <section
                          class="my-2"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            External Link
                          </h3>
                          <div
                            v-if="typeof item.attributes === 'object'"
                            v-html="item.attributes.externalLink"
                          />
                        </section>
                      </v-container>
                    </v-card>
                    <v-card class="mt-3">
                      <v-container>
                        <h3 class="headline mb-0 text-xs-center">
                          Case
                        </h3>
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Status') }}
                          </h3>
                          <div>
                            <span class="label">
                              {{ item.status | capitalize }}
                            </span>
                            <span
                              v-if="statusNote && statusNote.user"
                            >&nbsp;{{ $t('by') }} <b>{{ statusNote.user }}</b> <br> ({{ statusNote.updateTime | timeago }})
                            </span>
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Timeout') }}
                          </h3>
                          <div>
                            {{ item.timeout }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Event') }}
                          </h3>
                          <div
                            class="clickable alert-word-break"
                            @click="queryBy('event', item.event)"
                          >
                            {{ item.event }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Correlate') }}
                          </h3>
                          <div
                            v-for="event in item.correlate"
                            :key="event"
                            class="clickable"
                            @click="queryBy('event', event)"
                          >
                            {{ event }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section
                          v-if="statusNote && statusNote.user && statusNote.text"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            Notes
                          </h3>
                          <div class="alert-word-break">
                            <v-icon small>
                              error_outline
                            </v-icon>
                            <i>&nbsp;{{ statusNote.text }}</i>
                          </div>
                        </section>
                      </v-container>
                    </v-card>
                  </v-flex>
                  <v-flex 
                    sm6 
                    md4
                  >
                    <v-card>
                      <v-container>
                        <h3 class="headline mb-0 text-xs-center">
                          Duplication
                        </h3>
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Type') }}
                          </h3>
                          <div>
                            <span class="label">
                              {{ item.type | splitCaps }}
                            </span>
                          </div>
                        </section>
                  
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('DuplicateCount') }}
                          </h3>
                          <div>
                            <span>
                              {{ item.duplicateCount }}
                            </span>
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Origin') }}
                          </h3>
                          <div
                            class="clickable"
                            @click="queryBy('origin', item.origin)"
                          >
                            {{ item.origin }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Repeat') }}
                          </h3>
                          <div>
                            <span class="label">
                              {{ item.repeat | capitalize }}
                            </span>
                          </div>
                        </section>
                      </v-container>
                    </v-card>
                    <v-card class="mt-3">
                      <v-container>
                        <h3 class="headline mb-0 text-xs-center">
                          Attributes
                        </h3>
                        <section
                          v-for="(value, attr) in item.attributes"
                          :key="attr"
                        >
                          <div v-if="!attr.includes('_raw')">
                            <h3
                              class="blue-grey--text body-1 text-uppercase"
                            >
                              {{ attr | splitCaps }}
                            </h3>
                            <div
                              v-if="typeof value === 'object'"
                            >
                              <span
                                v-for="v in value"
                                :key="v"
                                @click="queryBy(`_.${attr}`, v)"
                              >
                                <span class="clickable">{{ v }}</span>&nbsp;
                              </span>
                            </div>
                            <div
                              v-else-if="typeof value === 'string' && (value.includes('http://') || value.includes('https://'))"
                              class="link-text"
                              style="overflow-wrap: break-word;"
                              v-html="value"
                            />
                            <div
                              v-else
                              class="clickable"
                              @click="queryBy(`_.${attr}`, value)"
                            >
                              {{ value }}
                            </div>

                            <v-divider class="my-2" />
                          </div>
                        </section>
                      </v-container>
                    </v-card>
                  </v-flex>
                  <v-flex 
                    sm6 
                    md4
                  >
                    <v-card>
                      <v-container>
                        <h3 class="headline mb-0 text-xs-center">
                          Alert Details
                        </h3>
                        <section
                          v-if="$config.customer_views"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('TrendIndication') }}
                          </h3>
                          <div>
                            <span class="label">
                              {{ item.trendIndication | splitCaps }}
                            </span>
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Value') }}
                          </h3>
                          <div>
                            {{ item.value }}
                          </div>
                        </section>
                        <section
                          v-if="$config.customer_views"
                        >
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Customer') }}
                          </h3>
                          <div
                            class="clickable"
                            @click="queryBy('customer', item.customer)"
                          >
                            {{ item.customer }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Environment') }}
                          </h3>
                          <div
                            class="clickable"
                            @click="queryBy('environment', item.environment)"
                          >
                            {{ item.environment }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Resource') }}
                          </h3>
                          <div
                            class="clickable"
                            @click="queryBy('resource', item.resource)"
                          >
                            {{ item.resource }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Group') }}
                          </h3>
                          <div
                            class="clickable"
                            @click="queryBy('group', item.group)"
                          >
                            {{ item.group }}
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('Tags') }}
                          </h3>
                          <div>
                            <v-chip
                              v-for="tag in item.tags"
                              :key="tag"
                              label
                              small
                              @click="queryBy('tags', tag)"
                            >
                              <v-icon left>
                                label
                              </v-icon>{{ tag }}
                            </v-chip>
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('AlertId') }}
                          </h3>
                          <span class="console-text">{{ item.id }}</span>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('LastReceiveAlertId') }}
                          </h3>
                          <span class="console-text">{{ item.lastReceiveId }}</span>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('CreateTime') }}
                          </h3>
                          <div>
                            <date-time
                              v-if="item.createTime"
                              :value="item.createTime"
                              format="longDate"
                            />
                            ({{ item.createTime | timeago }})
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('ReceiveTime') }}
                          </h3>
                          <div>
                            <date-time
                              v-if="item.receiveTime"
                              :value="item.receiveTime"
                              format="longDate"
                            />
                            ({{ item.receiveTime | timeago }})
                          </div>
                        </section>
                        <v-divider class="my-2" />
                        <section>
                          <h3
                            class="blue-grey--text body-1 text-uppercase"
                          >
                            {{ $t('LastReceiveTime') }}
                          </h3>
                          <div>
                            <date-time
                              v-if="item.lastReceiveTime"
                              :value="item.lastReceiveTime"
                              format="longDate"
                            />
                            ({{ item.lastReceiveTime | timeago }})
                          </div>
                        </section>
                      </v-container>
                    </v-card>
                  </v-flex>
                </v-layout>
              </v-container>
            </v-card>
          </v-tab-item>

          <v-tab ripple>
            <v-icon>history</v-icon>&nbsp;{{ $t('History') }}
          </v-tab>
          <v-tab-item
            :transition="false"
            :reverse-transition="false"
          >
            <div class="tab-item-wrapper">
              <v-data-table
                :headers="headersByScreenSize"
                :items="history"
                item-key="index"
                :pagination.sync="pagination"
                sort-icon="arrow_drop_down"
              >
                <template
                  slot="items"
                  slot-scope="props"
                >
                  <td class="hidden-sm-and-down">
                    <span class="console-text">{{ props.item.id | shortId }}</span>
                  </td>
                  <td
                    class="hidden-sm-and-down text-no-wrap"
                  >
                    <date-time
                      :value="props.item.updateTime"
                      format="mediumDate"
                    />
                  </td>
                  <td
                    class="hidden-md-and-up text-no-wrap"
                  >
                    <date-time
                      :value="props.item.updateTime"
                      format="shortTime"
                    />
                  </td>
                  <td class="hidden-sm-and-down">
                    <span :class="['label', 'label-' + props.item.severity]">
                      {{ props.item.severity | capitalize }}
                    </span>
                  </td>
                  <td class="hidden-sm-and-down">
                    <span class="label">
                      {{ props.item.status | capitalize }}
                    </span>
                  </td>
                  <td class="hidden-sm-and-down">
                    {{ props.item.timeout | hhmmss }}
                  </td>
                  <td>
                    <span class="label">
                      {{ props.item.type || 'unknown' | splitCaps }}
                    </span>
                  </td>
                  <td class="hidden-sm-and-down">
                    {{ props.item.event }}
                  </td>
                  <td class="hidden-sm-and-down">
                    {{ props.item.value }}
                  </td>
                  <td>
                    {{ props.item.user }}
                  </td>
                  <td>
                    {{ props.item.text }}
                  </td>
                </template>
              </v-data-table>
            </div>
          </v-tab-item>

          <v-tab ripple>
            <v-icon>assessment</v-icon>&nbsp;{{ $t('Data') }}
          </v-tab>
          <v-tab-item
            :transition="false"
            :reverse-transition="false"
          >
            <v-card
              :color="isDark ? 'grey darken-1' : 'grey lighten-3'"
              class="mx-1"
              style="overflow-x: auto;"
              flat
            >
              <v-card-text>
                <span class="console-text">{{ item.rawData || 'no raw data' }}</span>
              </v-card-text>
            </v-card>
          </v-tab-item>
        </v-tabs>
      </v-card>
    </v-card>
  </v-card>
</template>

<script>
import debounce from 'lodash/debounce'
import DateTime from './lib/DateTime'
import i18n from '@/plugins/i18n'
import AlertActions from '@/components/AlertActions'

export default {
  components: {
    DateTime,
    AlertActions,
  },
  props: {
    id: {
      type: String,
      required: true
    }
  },
  data: () => ({
    dialog: true,
    sheet: false,
    active: null,
    pagination: {
      rowsPerPage: 10,
      sortBy: 'updateTime',
      descending: true
    },
    headers: [
      { text: i18n.t('AlertOrNoteId'), value: 'id', hide: 'smAndDown' },
      { text: i18n.t('UpdateTime'), value: 'updateTime', hide: 'smAndDown' },
      { text: i18n.t('Updated'), value: 'updateTime', hide: 'mdAndUp' },
      { text: i18n.t('Severity'), value: 'severity', hide: 'smAndDown' },
      { text: i18n.t('Status'), value: 'status', hide: 'smAndDown' },
      { text: i18n.t('Timeout'), value: 'timeout', hide: 'smAndDown' },
      { text: i18n.t('Type'), value: 'type' },
      { text: i18n.t('Event'), value: 'event', hide: 'smAndDown' },
      { text: i18n.t('Value'), value: 'value', hide: 'smAndDown' },
      { text: i18n.t('User'), value: 'user' },
      { text: i18n.t('Text'), value: 'text' }
    ],
    copyIconText: i18n.t('Copy')
  }),
  computed: {
    isDark() {
      return this.$store.getters.getPreference('isDark')
    },
    item() {
      return this.$store.state.alerts.alert
    },
    actions() {
      return this.$config.actions
    },
    history() {
      return this.item.history
        ? this.item.history.map((h, index) => ({ index: index, ...h }))
        : []
    },
    notes() {
      return this.$store.state.alerts.notes
    },
    // DEPRECATED: notes stored in alert history are deprecated and will be removed in version 8
    historyNotes() {
      return this.history
        .filter(h => h.type == 'note' && h.id == this.id)  // get notes from alert history
    },
    hasHistoryNotes() {
      return this.$store.state.alerts.notes.length
    },
    statusNote() {
      return this.history.filter(h => h.type != 'note' && h.status == this.item.status).pop()
    },
    headersByScreenSize() {
      return this.headers.filter(
        h => !h.hide || !this.$vuetify.breakpoint[h.hide]
      )
    },
    ackTimeout() {
      return this.$store.getters.getPreference('ackTimeout')
    },
    shelveTimeout() {
      return this.$store.getters.getPreference('shelveTimeout')
    },
    username() {
      return this.$store.getters['auth/getUsername']
    },
    refresh() {
      return this.$store.state.refresh
    }
  },
  watch: {
    dialog(val) {
      val || this.close()
    },
    refresh(val) {
      if (val) {
        this.getAlert(this.id)
        this.getNotes(this.id)
      }
    }
  },
  created() {
    this.getAlert(this.id)
    this.getNotes(this.id)
  },
  methods: {
    getAlert() {
      this.$store.dispatch('alerts/getAlert', this.id)
    },
    getNotes() {
      this.$store.dispatch('alerts/getNotes', this.id)
    },
    isOpen(status) {
      return status == 'open' || status == 'NORM'
    },
    isWatched(tags) {
      const tag = `watch:${this.username}`
      return tags ? tags.indexOf(tag) > -1 : false
    },
    isAcked(status) {
      return status == 'ack' || status == 'ACKED'
    },
    isShelved(status) {
      return status == 'shelved' || status == 'SHLVD'
    },
    isClosed(status) {
      return status == 'closed'
    },
    deleteNote(alertId, noteId) {
      this.$store.dispatch('alerts/deleteNote', [alertId, noteId])
    },
    displayNotes(bool) {
      this.$store.dispatch('alerts/displayNotes', bool)
    },
    beforeAckAlert(id) {
      alert('Before ack this alert, you should add note explaining why :)')
      this.toggleNoteDialog(true)
      this.$store.commit('alerts/SET_NOTE_BEFORE_ACK', true)
    },
    changeSeverity: debounce(function() {
      this.$store.dispatch('alerts/setChangeSeverity', true)
    }, 200, {leading: true, trailing: false}),
    assignAlert: debounce(function() {
      this.$store.dispatch('alerts/setAssignTo', true)
    }, 200, {leading: true, trailing: false}),
    createTicket: debounce(function(id) {
      this.$store
        .dispatch('alerts/createTicket', id)
        .then(() => this.getAlert(id))
    }, 200, {leading: true, trailing: false}),
    takeAction: debounce(function(id, action, text) {
      this.$store
        .dispatch('alerts/takeAction', [id, action, text])
        .then(() => this.getAlert(this.id))
    }, 200, {leading: true, trailing: false}),
    ackAlert: debounce(function(id, text) {
      this.$store
        .dispatch('alerts/takeAction', [id, 'ack', text, this.ackTimeout])
        .then(() => this.getAlert(this.id))
    }, 200, {leading: true, trailing: false}),
    shelveAlert: debounce(function(id, text) {
      this.$store
        .dispatch('alerts/takeAction', [id, 'shelve', text, this.shelveTimeout])
        .then(() => this.getAlert(this.id))
    }, 200, {leading: true, trailing: false}),
    watchAlert: debounce(function(id) {
      this.$store
        .dispatch('alerts/watchAlert', id)
        .then(() => this.getAlert(this.id))
    }, 200, {leading: true, trailing: false}),
    unwatchAlert: debounce(function(id) {
      this.$store
        .dispatch('alerts/unwatchAlert', id)
        .then(() => this.getAlert(this.id))
    }, 200, {leading: true, trailing: false}),
    toggleNoteDialog: debounce(function(bool) {
      this.$store.dispatch('alerts/toggleNoteDialog', bool)
    }, 200, {leading: true, trailing: false}),
    deleteAlert: debounce(function(id) {
      confirm(i18n.t('ConfirmDelete')) &&
        this.$store.dispatch('alerts/deleteAlert', id)
          .then(() => this.$router.push({ name: 'alerts' }))
    }, 200, {leading: true, trailing: false}),
    queryBy(attribute, value) {
      this.$router.push({ path: `/alerts?q=${attribute}:"${value}"` })  // double-quotes (") around value mean exact match
    },
    close() {
      this.$emit('close')
    },
    clipboardCopy(text) {
      this.copyIconText = i18n.t('Copied')
      let textarea = document.createElement('textarea')
      textarea.textContent = text
      document.body.appendChild(textarea)
      textarea.select()
      document.execCommand('copy')
      document.body.removeChild(textarea)
      setTimeout(() => {
        this.copyIconText = i18n.t('Copy')
      }, 2000)
    }
  }
}
</script>

<style>
.label {
  font-size: 13px;
  font-weight: bold;
  line-height: 14px;
  color: #ffffff;
  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
  white-space: nowrap;
  vertical-align: baseline;
  background-color: #999999;
}

.label {
  padding: 1px 4px 2px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

.label-critical {
  background-color: #b94a48;
}

.label-major {
  background-color: #f89406;
}

.label-minor {
  background-color: #ffd700;
}

.label-warning {
  background-color: #3a87ad;
}

.label-normal,
.label-cleared,
.label-ok,
.label-informational {
  background-color: #468847;
}

.label-inverse {
  background-color: #333333;
}

.v-alert__dismissible {
  margin-top: 8px;
}

.console-text {
  font-size: 14px;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  white-space: pre;
  line-height: 1;
}

div.clickable, span.clickable {
  cursor: pointer;
  color: #3f51b5;
  font-weight: 400;
  text-decoration: underline;
}

.theme--dark div.clickable, .theme--dark span.clickable, .theme--dark div.link-text a {
  color: orange;
}

div.clickable:hover, span.clickable:hover, div.link-text a:hover {
  text-decoration: none;
}

#alerta .v-chip__content {
  cursor: pointer;
}

.alert-word-break{
  word-break: break-all;
}
</style>
